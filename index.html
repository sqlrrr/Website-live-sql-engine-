<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL ENGINE | Autonomous Intelligence Hub</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

    <style>
        :root {
            --bg-base: #050608;
            --panel-bg: #0d1117;
            --accent: #00e5ff;
            --green: #00ff88;
            --red: #ff3366;
            --border: #1f2937;
            --text-dim: #9ca3af;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }
        body { background: var(--bg-base); color: #fff; display: flex; height: 100vh; overflow: hidden; }

        /* Left Navigation Bar */
        .sidebar { width: 60px; background: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 25px; }
        .nav-icon { color: var(--text-dim); cursor: pointer; transition: 0.2s; font-size: 1.2rem; }
        .nav-icon:hover, .nav-icon.active { color: var(--accent); }

        /* Main Workspace */
        .workspace { flex: 1; display: grid; grid-template-columns: 300px 1fr 350px; grid-template-rows: 60px 1fr 200px; gap: 8px; padding: 8px; }

        /* Top Macro Bar */
        .macro-bar { grid-column: 1 / 4; background: var(--panel-bg); border: 1px solid var(--border); border-radius: 4px; display: flex; align-items: center; padding: 0 20px; gap: 30px; }
        .macro-item { font-size: 12px; display: flex; gap: 8px; }
        .macro-label { color: var(--text-dim); }

        /* Left Panel: Market & Orderbook */
        .left-panel { grid-row: 2 / 4; display: flex; flex-direction: column; gap: 8px; }
        .orderbook { flex: 1; background: var(--panel-bg); border: 1px solid var(--border); padding: 10px; font-size: 11px; }
        .ob-row { display: flex; justify-content: space-between; padding: 2px 0; }

        /* Center Panel: Main Chart & Signals */
        .center-panel { display: flex; flex-direction: column; gap: 8px; }
        .chart-window { flex: 1; background: var(--panel-bg); border: 1px solid var(--border); position: relative; overflow: hidden; }
        .ai-overlay { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); border: 1px solid var(--accent); padding: 15px; border-radius: 4px; z-index: 10; }

        /* Right Panel: Intelligence & Social Sentiment */
        .right-panel { grid-row: 2 / 4; display: flex; flex-direction: column; gap: 8px; }
        .intel-card { background: var(--panel-bg); border: 1px solid var(--border); padding: 15px; }
        .sentiment-meter { height: 10px; background: #1f2937; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        .sentiment-fill { height: 100%; transition: 0.5s; }

        /* Bottom Terminal */
        .bottom-terminal { grid-column: 2 / 3; background: #000; border: 1px solid var(--border); padding: 10px; font-size: 11px; color: var(--green); overflow-y: auto; }

        /* Helper Classes */
        .tag { font-size: 9px; padding: 2px 6px; border-radius: 3px; background: #1f2937; color: var(--accent); }
        .glow-text { text-shadow: 0 0 10px var(--accent); }
    </style>
</head>
<body>

    <nav class="sidebar">
        <i class="fas fa-microchip nav-icon active"></i>
        <i class="fas fa-chart-line nav-icon"></i>
        <i class="fas fa-network-wired nav-icon"></i>
        <i class="fas fa-shield-halved nav-icon"></i>
        <i class="fas fa-gear nav-icon"></i>
    </nav>

    <div class="workspace">
        <div class="macro-bar">
            <div class="macro-item"><span class="macro-label">DXY</span><span id="dxy-val">102.45</span></div>
            <div class="macro-item"><span class="macro-label">BTC GAS</span><span id="gas-val" style="color:var(--green)">18 Gwei</span></div>
            <div class="macro-item"><span class="macro-label">DOMINANCE</span><span>52.1%</span></div>
            <div class="macro-item"><span class="macro-label">GLOBAL MKT CAP</span><span>$2.41T</span></div>
            <div style="margin-left: auto;" class="tag glow-text">NODE STATUS: OPTIMIZED</div>
        </div>

        <div class="left-panel">
            <div class="orderbook">
                <div style="margin-bottom:10px; border-bottom:1px solid #333">LIQUIDITY DEPTH (BINANCE)</div>
                <div id="ask-wall" style="color:var(--red)"></div>
                <div id="price-current" style="font-size: 20px; text-align: center; margin: 10px 0;">--</div>
                <div id="bid-wall" style="color:var(--green)"></div>
            </div>
            <div class="intel-card">
                <div style="font-size:12px; margin-bottom:10px;">TOP 100 WALLETS FLOW</div>
                <canvas id="whaleChart" height="150"></canvas>
            </div>
        </div>

        <div class="center-panel">
            <div class="chart-window" id="mainChartContainer">
                <div class="ai-overlay">
                    <div style="font-size:10px; color:var(--text-dim)">AI CONSENSUS</div>
                    <div id="final-decision" style="font-size:24px; font-weight:bold;">ANALYZING...</div>
                    <div id="conf-meter" style="font-size:12px; margin-top:5px;">Confidence: 0%</div>
                </div>
            </div>
        </div>

        <div class="bottom-terminal" id="terminal">
            <div>[SYSTEM] SQL Engine Booting...</div>
            <div>[SYSTEM] Establishing WebSocket connection to Global Market Data...</div>
            <div>[SYSTEM] Reading Bitcoin Bitnodes... <span style="color:var(--accent)">DONE</span></div>
        </div>

        <div class="right-panel">
            <div class="intel-card">
                <div style="font-size:12px;">GLOBAL SENTIMENT (NLP)</div>
                <div class="sentiment-meter"><div id="sent-fill" class="sentiment-fill" style="width:50%; background:var(--accent)"></div></div>
                <div style="display:flex; justify-content:space-between; font-size:10px;">
                    <span>FEAR</span><span>NEUTRAL</span><span>GREED</span>
                </div>
            </div>
            <div class="intel-card" style="flex:1;">
                <div style="font-size:12px; margin-bottom:10px;">WHALE ALERTS (LIVE)</div>
                <div id="whale-feed" style="font-size:11px; line-height:1.6;">
                    <div style="color:var(--gold)">Searching for on-chain anomalies...</div>
                </div>
            </div>
            <div class="intel-card">
                <button id="ai-toggle" style="width:100%; padding:10px; background:transparent; border:1px solid var(--accent); color:var(--accent); cursor:pointer;">MANUAL INTERVENTION ON</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCVn3r1NcjW1OcSxBfWMSFcJ_db-i7p6uc",
            authDomain: "sqlrrr.firebaseapp.com",
            projectId: "sqlrrr",
            storageBucket: "sqlrrr.firebasestorage.app",
            messagingSenderId: "605955318342",
            appId: "1:605955318342:web:7f097ac1b565c5a3b16047",
            measurementId: "G-R1NFCH5C8V"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Chart Init
        const chart = LightweightCharts.createChart(document.getElementById('mainChartContainer'), {
            layout: { background: { color: '#0d1117' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
        });
        const candleSeries = chart.addCandlestickSeries();

        // Listen for AI Engine Data
        const engineRef = ref(db, 'sql_engine_live');
        onValue(engineRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                updateInterface(data);
            }
        });

        function updateInterface(data) {
            // Update Signal
            const decBox = document.getElementById('final-decision');
            decBox.innerText = data.ai.action;
            decBox.style.color = data.ai.action === 'BUY' ? 'var(--green)' : 'var(--red)';
            
            document.getElementById('conf-meter').innerText = `Confidence: ${(data.ai.confidence * 100).toFixed(2)}%`;
            document.getElementById('price-current').innerText = `$${parseFloat(data.market.price).toLocaleString()}`;
            
            // Terminal Log
            const term = document.getElementById('terminal');
            const entry = document.createElement('div');
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] AI Engine Decision: <span style="color:var(--accent)">${data.ai.action}</span> (Confidence: ${data.ai.confidence})`;
            term.prepend(entry);

            // Sentiment meter
            document.getElementById('sent-fill').style.width = (data.ai.sentiment || 50) + '%';
        }

    </script>
</body>
</html>
